---
import NameBanner from "@components/NameBanner.astro";
import NavLink from "@components/NavLink.vue";
import DefaultLayout from "@layouts/Default.astro";

import { CollectionEntry, getCollection } from "astro:content";

import moment from "plugins/moment";

const { post } = Astro.props;

export async function getStaticPaths({}) {
  const posts = await getCollection("articles");

  const data = posts.map((post) => {
    return {
      params: {
        slug: post.slug,
      },
      props: { post },
    };
  });

  return data;
}

interface Props {
  post: CollectionEntry<"articles">;
}

const { title, description, published, tags } = post.data;

const { Content } = await post.render();

const postsAfter = await getCollection("articles", ({ data }) => {
  return data.published.getTime() < post.data.published.getTime();
});

const [after] = postsAfter.sort(
  (a, b) => b.data.published.getTime() - a.data.published.getTime()
);

const postsBefore = await getCollection("articles", ({ data }) => {
  return data.published.getTime() > post.data.published.getTime();
});

const [before] = postsBefore.sort(
  (a, b) => a.data.published.getTime() - b.data.published.getTime()
);
---

<DefaultLayout title={title} description={description}>
  <div class="my-8">
    <NameBanner />

    <div class="mt-8">
      <div class="font-normal text-4xl">
        <NavLink to="/">&lt;</NavLink>
        <NavLink to="/blog">Blog</NavLink>
      </div>

      <div class="my-8">
        <div class="flex leading-none flex-col space-y-2">
          <h1 class="text-4xl">{title}</h1>
          <h2 class="text-lg italic">{description}</h2>
          <p class="text-gray-500">
            {moment(published).fromNow()}
          </p>
          <div class="flex flex-row gap-x-2 font-light">
            {
              tags?.map((tag) => (
                <a
                  href={`/tag/${tag}`}
                  class="px-2 py-2 bg-gray-200 dark:bg-gray-800 hover:dark:bg-gray-600 rounded"
                >
                  {tag}
                </a>
              ))
            }
          </div>
        </div>
      </div>

      <div>
        <div class="content">
          <Content />
        </div>

        <div
          class="flex flex-row w-full mt-8 font-normal text-4xl justify-between"
        >
          <div>
            {
              before ? (
                <NavLink to={`/post/${before.slug}`} rel="next">Next</NavLink>
              ) : null
            }
          </div>

          <div>
            {
              after ? (
                <NavLink to={`/post/${after.slug}`} rel="prev">Previous</NavLink>
              ) : null
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</DefaultLayout>
